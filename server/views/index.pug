doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Dashboard de Altura de Vehículos
    link(href="./styles/style.css" rel="stylesheet")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")
  body.bg-gray-100.text-gray-900
    // Encabezado
    header.bg-blue-600.text-white.p-4
      h1.text-3xl.font-bold Dashboard de Altura de Vehículos

    // Contenido Principal
    main.p-4
      section.bg-white.p-6.rounded.shadow-md
        h2.text-2xl.font-semibold.mb-4 Altura Actual del Vehículo
        .flex.items-center.justify-center.mb-4
          #currentHeight.text-6xl.font-bold.text-blue-600 - cm

      section.bg-white.p-6.rounded.shadow-md.mt-6
        h2.text-2xl.font-semibold.mb-4 Historial de Alturas
        table.min-w-full.bg-white.mb-6
          thead
            tr
              th.py-2.px-4.border-b Fecha
              th.py-2.px-4.border-b Hora
              th.py-2.px-4.border-b Altura
          tbody#historyTable
            // Las filas se agregarán dinámicamente
        
        // Gráfico de línea
        .bg-white.p-6.rounded.shadow-md.mt-6
          h2.text-2xl.font-semibold.mb-4 Gráfico de Lecturas
          canvas#lineChart

    // Pie de Página
    footer.bg-gray-800.text-white.p-4.mt-8.text-center
      p &copy; 2024 Mi Proyecto Arduino. Todos los derechos reservados.

    script.
      const socket = new WebSocket('ws://localhost:3000');

      const labels = [];
      const data = {
        labels: labels,
        datasets: [{
          label: 'Altura de Vehículos (cm)',
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          data: [],
          fill: false,
          tension: 0.1
        }]
      };

      const config = {
        type: 'line',
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Altura de Vehículos en el Tiempo'
            }
          }
        }
      };

      window.onload = function() {
        const ctx = document.getElementById('lineChart').getContext('2d');
        window.lineChart = new Chart(ctx, config);
      };

      socket.onmessage = function (event) {
        const sensorData = event.data;
        const currentTime = new Date().toLocaleString();
        const [date, time] = currentTime.split(", ");

        // Actualizar la altura actual
        document.getElementById('currentHeight').textContent = `${sensorData} cm`;

        // Actualizar el gráfico
        if (labels.length >= 10) {
          labels.shift();
          data.datasets[0].data.shift();
        }
        labels.push(time);
        data.datasets[0].data.push(sensorData);
        window.lineChart.update();

        // Actualizar la tabla
        const tableBody = document.getElementById('historyTable');
        if (tableBody.children.length >= 10) {
          tableBody.removeChild(tableBody.firstChild);
        }
        const row = document.createElement('tr');
        const dateCell = document.createElement('td');
        const timeCell = document.createElement('td');
        const heightCell = document.createElement('td');

        dateCell.className = 'py-2 px-4 border-b';
        timeCell.className = 'py-2 px-4 border-b';
        heightCell.className = 'py-2 px-4 border-b';

        dateCell.textContent = date;
        timeCell.textContent = time;
        heightCell.textContent = `${sensorData} cm`;

        row.appendChild(dateCell);
        row.appendChild(timeCell);
        row.appendChild(heightCell);
        tableBody.appendChild(row);
      };
